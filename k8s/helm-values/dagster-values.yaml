# Dagster Helm values for sovereign-dp lakehouse

global:
  serviceAccountName: dagster

dagsterWebserver:
  replicaCount: 1
  service:
    type: NodePort
    port: 3000
  livenessProbe:
    httpGet:
      path: /server_info
      port: 3000
    initialDelaySeconds: 120
    periodSeconds: 20
    timeoutSeconds: 10
    failureThreshold: 5
  readinessProbe:
    httpGet:
      path: /server_info
      port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
  startupProbe:
    httpGet:
      path: /server_info
      port: 3000
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 30
  resources:
    requests:
      memory: 512Mi
      cpu: 100m
    limits:
      memory: 1Gi
      cpu: 500m

dagsterDaemon:
  enabled: true
  resources:
    requests:
      memory: 512Mi
      cpu: 100m
    limits:
      memory: 1Gi
      cpu: 500m

# External PostgreSQL (deployed separately)
postgresql:
  enabled: false
  postgresqlHost: dagster-postgresql.sovereign-dp.svc.cluster.local
  postgresqlPort: 5432
  postgresqlUsername: dagster
  postgresqlDatabase: dagster

generatePostgresqlPasswordSecret: false

postgresqlSecretName: dagster-postgresql-secret

# Compute logs - using default for now
computeLogs:
  enabled: false

# Run launcher configuration
runLauncher:
  type: K8sRunLauncher
  config:
    k8sRunLauncher:
      envSecrets:
        - name: dagster-env

# User code deployments
dagster-user-deployments:
  enabled: true
  deployments:
    - name: sovereign-dp-pipelines
      image:
        repository: sovereign-dp-dagster
        tag: latest
        pullPolicy: IfNotPresent
      dagsterApiGrpcArgs:
        - "--module-name"
        - "sovereign_dp_dagster"
      port: 3030
      envSecrets:
        - name: dagster-env
      resources:
        requests:
          memory: 256Mi
          cpu: 100m
        limits:
          memory: 1Gi
          cpu: 1
